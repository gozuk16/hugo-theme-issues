{{- /*
JIRA Issue メタデータ用サイドバー

JIRA issueページで使用される、issue固有のメタデータを表示します。
データは jira_metadata shortcode から .Scratch 経由で取得します。

@context {page} page The current page.

@example: {{ partial "sidebar-page-meta.html" . }}
*/}}
sidebar-page-meta.html


{{- /* 基本情報 */}}
<section class="issue-basic-info page-meta">
  <h3>基本情報</h3>

  {{- /* Issue ID */}}
  {{- with .Scratch.Get "issue_id" }}
    <div class="meta-item">
      <strong>Issue ID:</strong><br>
      {{ . }}
    </div>
  {{- end }}

  {{- /* ステータス */}}
  {{- with .Scratch.Get "status" }}
    <div class="meta-item">
      <strong>ステータス:</strong><br>
      {{ . }}
    </div>
  {{- end }}

  {{- /* 優先度 */}}
  {{- with .Scratch.Get "priority" }}
    <div class="meta-item">
      <strong>優先度:</strong><br>
      {{ . }}
    </div>
  {{- end }}

  {{- /* Issue Type */}}
  {{- with .Scratch.Get "issue_type" }}
    <div class="meta-item">
      <strong>Issue Type:</strong><br>
      {{ . }}
    </div>
  {{- end }}

  {{- /* ラベル（Hugoタグとしてリンク表示） */ -}}
  {{- with .Scratch.Get "labels" }}
    <div class="meta-item">
      <strong>ラベル:</strong><br>
      {{- if reflect.IsSlice . }}
        <ul class="tag-list" style="margin-top: 0.5rem;">
          {{- range $label := . }}
            {{- $tag := $.Site.GetPage (printf "/tags/%s" ($label | urlize)) }}
            {{- if $tag }}
              <li><a href="{{ $tag.RelPermalink }}" class="tag-badge">{{ $label }}</a></li>
            {{- else }}
              <li><span class="tag-badge">{{ $label }}</span></li>
            {{- end }}
          {{- end }}
        </ul>
      {{- else }}
        {{- $tag := $.Site.GetPage (printf "/tags/%s" (. | urlize)) }}
        {{- if $tag }}
          <a href="{{ $tag.RelPermalink }}" class="tag-badge">{{ . }}</a>
        {{- else }}
          <span class="tag-badge">{{ . }}</span>
        {{- end }}
      {{- end }}
    </div>
  {{- end }}
</section>

{{- /* 時間管理情報 */}}
{{- if or (.Scratch.Get "initial_estimate") (.Scratch.Get "remaining_estimate") (.Scratch.Get "time_spent") }}
  <section class="issue-time-tracking page-meta">
    <h3>時間管理</h3>

    {{- with .Scratch.Get "initial_estimate" }}
      <div class="meta-item">
        <strong>初期見積り:</strong><br>
        {{ . }}
      </div>
    {{- end }}

    {{- with .Scratch.Get "remaining_estimate" }}
      <div class="meta-item">
        <strong>残り時間:</strong><br>
        {{ . }}
      </div>
    {{- end }}

    {{- with .Scratch.Get "time_spent" }}
      <div class="meta-item">
        <strong>作業時間:</strong><br>
        {{ . }}
      </div>
    {{- end }}
  </section>
{{- end }}

{{- /* 開発情報（GitHub/Bitbucket統合） */}}
{{- if or (.Scratch.Get "dev_pull_requests") (.Scratch.Get "dev_branches") }}
  <section class="issue-development page-meta">
    <h3>開発情報</h3>

    {{- /* プルリクエスト */}}
    {{- with .Scratch.Get "dev_pull_requests" }}
      <div class="meta-item">
        <strong>プルリクエスト:</strong><br>
        {{- range . }}
          <div style="margin-left: 1rem; margin-top: 0.5rem;">
            {{- if .url }}
              <a href="{{ .url }}" target="_blank">{{ .name }}</a>
            {{- else }}
              {{ .name }}
            {{- end }}
            {{- if .author }}
              <br><small>作成者: {{ .author }}</small>
            {{- end }}
            {{- if .branch }}
              <br><small>ブランチ: <code>{{ .branch }}</code></small>
            {{- end }}
            {{- if .status }}
              <br><small>状態: {{ .status }}</small>
            {{- end }}
          </div>
        {{- end }}
      </div>
    {{- end }}

    {{- /* ブランチ */}}
    {{- with .Scratch.Get "dev_branches" }}
      <div class="meta-item">
        <strong>ブランチ:</strong><br>
        {{- range . }}
          <div style="margin-left: 1rem; margin-top: 0.5rem;">
            {{- if .url }}
              <a href="{{ .url }}" target="_blank"><code>{{ .name }}</code></a>
            {{- else }}
              <code>{{ .name }}</code>
            {{- end }}
          </div>
        {{- end }}
      </div>
    {{- end }}
  </section>
{{- end }}

{{- /* プロジェクト情報 */}}
<section class="issue-dev-info page-meta">
  <h3>プロジェクト情報</h3>

  {{- /* 担当者 */}}
  {{- with .Scratch.Get "assignee" }}
    <div class="meta-item">
      <strong>担当者:</strong><br>
      {{ . }}
    </div>
  {{- end }}

  {{- /* 報告者 */}}
  {{- with .Scratch.Get "reporter" }}
    <div class="meta-item">
      <strong>報告者:</strong><br>
      {{ . }}
    </div>
  {{- end }}

  {{- /* プロジェクト */}}
  {{- with .Scratch.Get "project" }}
    <div class="meta-item">
      <strong>プロジェクト:</strong><br>
      {{ . }}
    </div>
  {{- end }}

  {{- /* コンポーネント */}}
  {{- with .Scratch.Get "components" }}
    <div class="meta-item">
      <strong>コンポーネント:</strong><br>
      {{- if reflect.IsSlice . }}
        {{- range . }}
          {{ . }}<br>
        {{- end }}
      {{- else }}
        {{ . }}
      {{- end }}
    </div>
  {{- end }}

  {{- /* バージョン */}}
  {{- with .Scratch.Get "version" }}
    <div class="meta-item">
      <strong>バージョン:</strong><br>
      {{ . }}
    </div>
  {{- end }}
</section>

{{- /* タグ */}}
{{- with .GetTerms "tags" }}
  <section class="widget">
    <h3>Tags</h3>
    <ul class="tag-list">
      {{- range . }}
        <li><a href="{{ .RelPermalink }}" class="tag-badge">{{ .LinkTitle }}</a></li>
      {{- end }}
    </ul>
  </section>
{{- end }}
