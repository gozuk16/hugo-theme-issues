{{- /*
å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ãƒšãƒ¼ã‚¸ä¸€è¦§

ã“ã®ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«ã¯ã€ç¾åœ¨è¡¨ç¤ºä¸­ã®ãƒšãƒ¼ã‚¸ã¨åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰å†…ã®ãƒšãƒ¼ã‚¸ã‚’ä¸€è¦§è¡¨ç¤ºã—ã¾ã™ã€‚
*/}}

{{- $currentPage := . }}

{{- /* ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã‚’å–å¾— */}}
{{- $currentSection := .CurrentSection }}

{{- /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º */}}
{{- if $currentSection }}
  <nav aria-label="Project pages">
    {{- /* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦è¡¨ç¤º */}}
    {{- with $currentSection.Params.title }}
      <h2>{{ . }}</h2>
    {{- else }}
      <h2>{{ $currentSection.Title }}</h2>
    {{- end }}

    {{- /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ã™ã¹ã¦ã®é€šå¸¸ãƒšãƒ¼ã‚¸ã‚’å–å¾— */}}
    {{- $pages := where $currentSection.RegularPages "Type" "page" }}

    {{- if $pages }}
      <ul>
        {{- /* ã‚¨ãƒ”ãƒƒã‚¯ã‚’æŠ½å‡ºã—ã¦ranké †ã«ã‚½ãƒ¼ãƒˆ */}}
        {{- $epics := slice }}
        {{- range $pages }}
          {{- if or (eq .Params.issue_type "Epic") (eq .Params.issue_type "ã‚¨ãƒ”ãƒƒã‚¯") }}
            {{- $epics = $epics | append . }}
          {{- end }}
        {{- end }}
        {{- $sortedEpics := sort $epics ".Params.rank" "asc" }}

        {{- /* ã‚¨ãƒ”ãƒƒã‚¯ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—è¡¨ç¤º */}}
        {{- range $epic := $sortedEpics }}
          {{- /* ã‚¨ãƒ”ãƒƒã‚¯è¡¨ç¤º */}}
          <li>
            <a href="{{ $epic.RelPermalink }}"
               {{- if eq $currentPage.RelPermalink $epic.RelPermalink }}
               class="active" aria-current="page"
               {{- end }}>
              {{- /* Issue Type ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º */}}
              <span class="issue-type-icon">
                {{- with $epic.Params.issue_type }}
                  {{- if or (eq . "Epic") (eq . "ã‚¨ãƒ”ãƒƒã‚¯") }}ğŸŸ£
                  {{- else if or (eq . "Story") (eq . "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼") }}ğŸ“—
                  {{- else if or (eq . "Task") (eq . "ã‚¿ã‚¹ã‚¯") }}â˜‘ï¸
                  {{- else if or (eq . "Sub-task") (eq . "Subtask") (eq . "ã‚µãƒ–ã‚¿ã‚¹ã‚¯") }}â¡ï¸
                  {{- else if or (eq . "Bug") (eq . "ãƒã‚°") }}ğŸ
                  {{- else }}ğŸ“„
                  {{- end }}
                {{- end }}
              </span>
              {{- with $epic.Params.issue_key }}{{ . }}: {{- end }}
              {{ $epic.Title }}
            </a>
          </li>

          {{- /* ã“ã®ã‚¨ãƒ”ãƒƒã‚¯ã®å­issueã‚’æŠ½å‡º */}}
          {{- $epicKey := $epic.Params.issue_key }}
          {{- $children := where $pages ".Params.parent" $epicKey }}
          {{- $sortedChildren := sort $children ".Params.rank" "asc" }}

          {{- /* å­issueã‚’è¡¨ç¤º */}}
          {{- range $child := $sortedChildren }}
            <li class="child-issue">
              <a href="{{ $child.RelPermalink }}"
                 {{- if eq $currentPage.RelPermalink $child.RelPermalink }}
                 class="active" aria-current="page"
                 {{- end }}>
                {{- /* Issue Type ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º */}}
                <span class="issue-type-icon">
                  {{- with $child.Params.issue_type }}
                    {{- if or (eq . "Epic") (eq . "ã‚¨ãƒ”ãƒƒã‚¯") }}ğŸŸ£
                    {{- else if or (eq . "Story") (eq . "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼") }}ğŸ“—
                    {{- else if or (eq . "Task") (eq . "ã‚¿ã‚¹ã‚¯") }}â˜‘ï¸
                    {{- else if or (eq . "Sub-task") (eq . "Subtask") (eq . "ã‚µãƒ–ã‚¿ã‚¹ã‚¯") }}â¡ï¸
                    {{- else if or (eq . "Bug") (eq . "ãƒã‚°") }}ğŸ
                    {{- else }}ğŸ“„
                    {{- end }}
                  {{- end }}
                </span>
                {{- with $child.Params.issue_key }}{{ . }}: {{- end }}
                {{ $child.Title }}
              </a>
            </li>
          {{- end }}
        {{- end }}

        {{- /* å­¤ç«‹issueã‚’è¡¨ç¤º */}}
        {{- /* ã‚¨ãƒ”ãƒƒã‚¯ã®issue_keyãƒªã‚¹ãƒˆã‚’ä½œæˆ */}}
        {{- $epicKeys := slice }}
        {{- range $sortedEpics }}
          {{- $epicKeys = $epicKeys | append .Params.issue_key }}
        {{- end }}

        {{- /* å­¤ç«‹issueã‚’æŠ½å‡ºã—ã¦ranké †ã«ã‚½ãƒ¼ãƒˆ */}}
        {{- $orphans := slice }}
        {{- range $page := $pages }}
          {{- $isOrphan := true }}
          {{- $isEpic := or (eq $page.Params.issue_type "Epic") (eq $page.Params.issue_type "ã‚¨ãƒ”ãƒƒã‚¯") }}

          {{- if $isEpic }}
            {{- $isOrphan = false }}
          {{- else if $page.Params.parent }}
            {{- if in $epicKeys $page.Params.parent }}
              {{- $isOrphan = false }}
            {{- end }}
          {{- end }}

          {{- if $isOrphan }}
            {{- $orphans = $orphans | append $page }}
          {{- end }}
        {{- end }}
        {{- $sortedOrphans := sort $orphans ".Params.rank" "asc" }}

        {{- /* å­¤ç«‹issueã‚’è¡¨ç¤º */}}
        {{- if $sortedOrphans }}
          <li class="orphan-section-divider"></li>
          {{- range $orphan := $sortedOrphans }}
            <li class="orphan-issue">
              <a href="{{ $orphan.RelPermalink }}"
                 {{- if eq $currentPage.RelPermalink $orphan.RelPermalink }}
                 class="active" aria-current="page"
                 {{- end }}>
                {{- /* Issue Type ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º */}}
                <span class="issue-type-icon">
                  {{- with $orphan.Params.issue_type }}
                    {{- if or (eq . "Epic") (eq . "ã‚¨ãƒ”ãƒƒã‚¯") }}ğŸŸ£
                    {{- else if or (eq . "Story") (eq . "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼") }}ğŸ“—
                    {{- else if or (eq . "Task") (eq . "ã‚¿ã‚¹ã‚¯") }}â˜‘ï¸
                    {{- else if or (eq . "Sub-task") (eq . "Subtask") (eq . "ã‚µãƒ–ã‚¿ã‚¹ã‚¯") }}â¡ï¸
                    {{- else if or (eq . "Bug") (eq . "ãƒã‚°") }}ğŸ
                    {{- else }}ğŸ“„
                    {{- end }}
                  {{- end }}
                </span>
                {{- with $orphan.Params.issue_key }}{{ . }}: {{- end }}
                {{ $orphan.Title }}
              </a>
            </li>
          {{- end }}
        {{- end }}
      </ul>
    {{- else }}
      <p>ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ãƒšãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {{- end }}
  </nav>
{{- end }}
