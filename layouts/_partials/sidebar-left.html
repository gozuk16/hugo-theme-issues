{{- /*
å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ãƒšãƒ¼ã‚¸ä¸€è¦§

ã“ã®ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«ã¯ã€ç¾åœ¨è¡¨ç¤ºä¸­ã®ãƒšãƒ¼ã‚¸ã¨åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰å†…ã®ãƒšãƒ¼ã‚¸ã‚’ä¸€è¦§è¡¨ç¤ºã—ã¾ã™ã€‚
*/}}

{{- $currentPage := . }}

{{- /* ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã‚’å–å¾— */}}
{{- $currentSection := .CurrentSection }}

{{- /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º */}}
{{- if $currentSection }}
  <nav aria-label="Project pages">
    {{- /* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦è¡¨ç¤º */}}
    <h2>
      {{- /* è¦ªéšå±¤ã¸ã®ãƒªãƒ³ã‚¯ */}}
      {{- if $currentSection.Parent }}
        <a href="{{ $currentSection.Parent.RelPermalink }}" class="parent-link" aria-label="è¦ªéšå±¤ã¸ç§»å‹•">â¬†ï¸</a>
      {{- end }}
      {{- /* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼ˆindexã¸ã®ãƒªãƒ³ã‚¯ï¼‰ */}}
      <a href="{{ $currentSection.RelPermalink }}" class="project-title">
        {{- with $currentSection.Params.title }}
          {{ . }}
        {{- else }}
          {{ $currentSection.Title }}
        {{- end }}
      </a>
    </h2>

    {{- /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ã™ã¹ã¦ã®é€šå¸¸ãƒšãƒ¼ã‚¸ã‚’å–å¾— */}}
    {{- $pages := where $currentSection.RegularPages "Type" "page" }}

    {{- if $pages }}
      <ul>
        {{- /* ã‚¨ãƒ”ãƒƒã‚¯ã‚’æŠ½å‡ºã—ã¦ranké †ã«ã‚½ãƒ¼ãƒˆ */}}
        {{- $epics := slice }}
        {{- range $pages }}
          {{- if or (eq .Params.issue_type "Epic") (eq .Params.issue_type "ã‚¨ãƒ”ãƒƒã‚¯") }}
            {{- $epics = $epics | append . }}
          {{- end }}
        {{- end }}
        {{- $sortedEpics := sort $epics ".Params.rank" "asc" }}

        {{- /* ã‚¨ãƒ”ãƒƒã‚¯ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—è¡¨ç¤º */}}
        {{- range $epic := $sortedEpics }}
          {{- /* ã‚¨ãƒ”ãƒƒã‚¯è¡¨ç¤º */}}
          <li>
            <a href="{{ $epic.RelPermalink }}"
               {{- if eq $currentPage.RelPermalink $epic.RelPermalink }}
               class="active" aria-current="page"
               {{- end }}>
              {{- /* Issue Type ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º */}}
              <span class="issue-type-icon">
                {{- with $epic.Params.issue_type }}
                  {{- if or (eq . "Epic") (eq . "ã‚¨ãƒ”ãƒƒã‚¯") }}ğŸŸ£
                  {{- else if or (eq . "Story") (eq . "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼") }}ğŸ“—
                  {{- else if or (eq . "Task") (eq . "ã‚¿ã‚¹ã‚¯") }}â˜‘ï¸
                  {{- else if or (eq . "Sub-task") (eq . "Subtask") (eq . "ã‚µãƒ–ã‚¿ã‚¹ã‚¯") }}â¡ï¸
                  {{- else if or (eq . "Bug") (eq . "ãƒã‚°") }}ğŸ
                  {{- else }}ğŸ“„
                  {{- end }}
                {{- end }}
              </span>
              {{- with $epic.Params.issue_key }}{{ . }}: {{- end }}
              {{ $epic.Title }}
            </a>
          </li>

          {{- /* ã“ã®ã‚¨ãƒ”ãƒƒã‚¯ã®å­issueã‚’æŠ½å‡º */}}
          {{- $epicKey := $epic.Params.issue_key }}
          {{- $children := where $pages ".Params.parent" $epicKey }}
          {{- $sortedChildren := sort $children ".Params.rank" "asc" }}

          {{- /* å­issueã‚’è¡¨ç¤º */}}
          {{- range $child := $sortedChildren }}
            <li class="child-issue">
              <a href="{{ $child.RelPermalink }}"
                 {{- if eq $currentPage.RelPermalink $child.RelPermalink }}
                 class="active" aria-current="page"
                 {{- end }}>
                {{- /* Issue Type ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º */}}
                <span class="issue-type-icon">
                  {{- with $child.Params.issue_type }}
                    {{- if or (eq . "Epic") (eq . "ã‚¨ãƒ”ãƒƒã‚¯") }}ğŸŸ£
                    {{- else if or (eq . "Story") (eq . "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼") }}ğŸ“—
                    {{- else if or (eq . "Task") (eq . "ã‚¿ã‚¹ã‚¯") }}â˜‘ï¸
                    {{- else if or (eq . "Sub-task") (eq . "Subtask") (eq . "ã‚µãƒ–ã‚¿ã‚¹ã‚¯") }}â¡ï¸
                    {{- else if or (eq . "Bug") (eq . "ãƒã‚°") }}ğŸ
                    {{- else }}ğŸ“„
                    {{- end }}
                  {{- end }}
                </span>
                {{- with $child.Params.issue_key }}{{ . }}: {{- end }}
                {{ $child.Title }}
              </a>
            </li>

            {{- /* ã“ã®å­issueã®å­issueï¼ˆå­«ï¼‰ã‚’æŠ½å‡º */}}
            {{- $childKey := $child.Params.issue_key }}
            {{- $grandchildren := where $pages ".Params.parent" $childKey }}
            {{- $sortedGrandchildren := sort $grandchildren ".Params.rank" "asc" }}

            {{- /* å­«issueã‚’è¡¨ç¤º */}}
            {{- range $grandchild := $sortedGrandchildren }}
              <li class="grandchild-issue">
                <a href="{{ $grandchild.RelPermalink }}"
                   {{- if eq $currentPage.RelPermalink $grandchild.RelPermalink }}
                   class="active" aria-current="page"
                   {{- end }}>
                  {{- /* Issue Type ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º */}}
                  <span class="issue-type-icon">
                    {{- with $grandchild.Params.issue_type }}
                      {{- if or (eq . "Epic") (eq . "ã‚¨ãƒ”ãƒƒã‚¯") }}ğŸŸ£
                      {{- else if or (eq . "Story") (eq . "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼") }}ğŸ“—
                      {{- else if or (eq . "Task") (eq . "ã‚¿ã‚¹ã‚¯") }}â˜‘ï¸
                      {{- else if or (eq . "Sub-task") (eq . "Subtask") (eq . "ã‚µãƒ–ã‚¿ã‚¹ã‚¯") }}â¡ï¸
                      {{- else if or (eq . "Bug") (eq . "ãƒã‚°") }}ğŸ
                      {{- else }}ğŸ“„
                      {{- end }}
                    {{- end }}
                  </span>
                  {{- with $grandchild.Params.issue_key }}{{ . }}: {{- end }}
                  {{ $grandchild.Title }}
                </a>
              </li>
            {{- end }}
          {{- end }}
        {{- end }}

        {{- /* å­¤ç«‹issueã‚’è¡¨ç¤º */}}
        {{- /* ã‚¨ãƒ”ãƒƒã‚¯é…ä¸‹ã®å…¨issueï¼ˆã‚¨ãƒ”ãƒƒã‚¯ã€å­ã€å­«ï¼‰ã®issue_keyãƒªã‚¹ãƒˆã‚’ä½œæˆ */}}
        {{- $epicFamilyKeys := slice }}
        {{- range $sortedEpics }}
          {{- $epicFamilyKeys = $epicFamilyKeys | append .Params.issue_key }}
          {{- /* å­issueã‚’è¿½åŠ  */}}
          {{- $epicKey := .Params.issue_key }}
          {{- $children := where $pages ".Params.parent" $epicKey }}
          {{- range $child := $children }}
            {{- $epicFamilyKeys = $epicFamilyKeys | append $child.Params.issue_key }}
            {{- /* å­«issueã‚’è¿½åŠ  */}}
            {{- $childKey := $child.Params.issue_key }}
            {{- $grandchildren := where $pages ".Params.parent" $childKey }}
            {{- range $grandchild := $grandchildren }}
              {{- $epicFamilyKeys = $epicFamilyKeys | append $grandchild.Params.issue_key }}
            {{- end }}
          {{- end }}
        {{- end }}

        {{- /* å­¤ç«‹issueã‚’æŠ½å‡ºã—ã¦ranké †ã«ã‚½ãƒ¼ãƒˆ */}}
        {{- $orphans := slice }}
        {{- range $page := $pages }}
          {{- /* ã‚¨ãƒ”ãƒƒã‚¯é…ä¸‹ã«å±ã•ãªã„issueã‚’å­¤ç«‹issueã¨ã™ã‚‹ */}}
          {{- if not (in $epicFamilyKeys $page.Params.issue_key) }}
            {{- $orphans = $orphans | append $page }}
          {{- end }}
        {{- end }}
        {{- $sortedOrphans := sort $orphans ".Params.rank" "asc" }}

        {{- /* å­¤ç«‹issueã‚’è¡¨ç¤º */}}
        {{- if $sortedOrphans }}
          <li class="orphan-section-divider"></li>
          {{- range $orphan := $sortedOrphans }}
            <li class="orphan-issue">
              <a href="{{ $orphan.RelPermalink }}"
                 {{- if eq $currentPage.RelPermalink $orphan.RelPermalink }}
                 class="active" aria-current="page"
                 {{- end }}>
                {{- /* Issue Type ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º */}}
                <span class="issue-type-icon">
                  {{- with $orphan.Params.issue_type }}
                    {{- if or (eq . "Epic") (eq . "ã‚¨ãƒ”ãƒƒã‚¯") }}ğŸŸ£
                    {{- else if or (eq . "Story") (eq . "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼") }}ğŸ“—
                    {{- else if or (eq . "Task") (eq . "ã‚¿ã‚¹ã‚¯") }}â˜‘ï¸
                    {{- else if or (eq . "Sub-task") (eq . "Subtask") (eq . "ã‚µãƒ–ã‚¿ã‚¹ã‚¯") }}â¡ï¸
                    {{- else if or (eq . "Bug") (eq . "ãƒã‚°") }}ğŸ
                    {{- else }}ğŸ“„
                    {{- end }}
                  {{- end }}
                </span>
                {{- with $orphan.Params.issue_key }}{{ . }}: {{- end }}
                {{ $orphan.Title }}
              </a>
            </li>
          {{- end }}
        {{- end }}
      </ul>
    {{- else }}
      <p>ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ãƒšãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {{- end }}
  </nav>
{{- end }}
